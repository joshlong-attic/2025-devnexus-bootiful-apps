<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Dogs List</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://unpkg.com/htmx.org@1.9.6"></script>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 20px;
        }

        tr {
            height: 3em;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        tr:hover {
            background-color: #f1f1f1;
        }

        .adoption-form {
            display: flex;
            gap: 8px;
        }

        .adoption-form input {
            flex-grow: 1;
        }

        .adopted {
            background-color: #e8f5e9;
        }

        button {
            padding: 4px 8px;
            cursor: pointer;
        }
    </style>
</head>
<body>
<h1 hx-preserve="true" id="dogs-list-title">Dogs List</h1>

<div id="dogs-table-container">
    <table>
        <thead>
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Owner</th>
            <th>Description</th>
            <th>Adoption</th>
        </tr>
        </thead>
        <tbody>
        <!-- Iterate over the 'dogs' collection -->
        <tr th:each="dog : ${dogs}" th:id="'dog-row-' + ${dog.id}" th:class="${dog.owner != null} ? 'adopted' : ''">
            <td th:text="${dog.id}">123</td>
            <td th:text="${dog.name}">Buddy</td>
            <td th:text="${dog.owner}">John Doe</td>
            <td th:text="${dog.description}">A friendly golden retriever</td>
            <td>
                <!-- Only show adoption form if dog doesn't have an owner -->
                <div th:if="${dog.owner == null}" class="adoption-form">
                    <input
                            type="text"
                            name="name"
                            placeholder="Your name"
                            th:id="'new-owner-' + ${dog.id}"
                    />
                    <input type="hidden" name="dogId" th:value="${dog.id}" th:id="'dog-id-' + ${dog.id}"/>
                    <button
                            hx-post="/adoptions.html"
                            th:attr="hx-include='#new-owner-' + ${dog.id}+',#dog-id-' + ${dog.id}"
                            hx-target="#dogs-table-container"
                            hx-swap="innerHTML"

                    >Adopt
                    </button>
                </div>
                <span th:unless="${dog.owner == null}" class="adopted-status">Already adopted</span>
            </td>
        </tr>
        </tbody>
    </table>

    <!-- Show a message if the collection is empty -->
    <p th:if="${#lists.isEmpty(dogs)}">No dogs found in the database.</p>
</div>

<div hx-preserve="true">
    <div hx-preserve="true" id="counter">0</div>
    <script>
        // Start with counter at 0
        window.addEventListener('load', () => {
            let count = 0;

            // Get reference to the counter div
            const counterDiv = document.getElementById('counter');

            // Set up interval to run every 1000ms (1 second)
            setInterval(() => {
                // Increment count
                count++;

                // Update the div content
                counterDiv.textContent = count;
            }, 1000);
        });
    </script>
</div>
</body>
</html>